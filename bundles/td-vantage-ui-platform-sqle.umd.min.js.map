{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://@td-vantage/ui-platform/sqle/query.service.ts","ng://@td-vantage/ui-platform/sqle/connection.service.ts","ng://@td-vantage/ui-platform/sqle/spooled-query.service.ts","ng://@td-vantage/ui-platform/sqle/dictionary.service.ts","ng://@td-vantage/ui-platform/sqle/credentials-dialog/credentials-dialog.component.ts","ng://@td-vantage/ui-platform/sqle/sqle.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","__spread","concat","VantageQueryService","_http","querySystem","connection","payload","headers","HttpHeaders","append","creds","set","attributes","_a","system","system_attributes","logMech","_b","log_mech","_c","clientId","post","nickname","pipe","catchError","httpStatus","status","map","resultSet","getTableInfo","databaseName","tableName","get","getViewInfo","viewName","getQuery","requestId","getQueries","sessionId","getQueryResult","queryId","deleteQuery","delete","createSession","autoCommit","transactionMode","charSet","deleteSession","Injectable","TdHttpService","VANTAGE_QUERY_PROVIDER_FACTORY","parent","tdHttpService","VANTAGE_QUERY_PROVIDER","provide","deps","Optional","SkipSelf","useFactory","stringify","VantageConnectionService","_queryService","_sessionService","_currentConnectionSubject","BehaviorSubject","_getConnectionState","current","_connectionsSubject","connections","currentConnection$","asObservable","connections$","connectionState","username","_currentUsername","_connections","_currentConnection","undefined","defineProperty","getValue","_setConnectionState","addAndSetAsCurrent","options","_getConnectionIndex","Error","_pingAndSave","add","setAsCurrent","remove","index","slice","_areEqual","unsetAsCurrent","removeAll","exists","isCurrent","currentConnection","opts","_this","query","timeout","retryWhen","errors","mergeMap","attempts","throwError","timer","tap","mapTo","user","connectionA","connectionB","findIndex","conn","JSON","parse","sessionStorage","getItem","setItem","VantageSessionService","VANTAGE_CONNECTION_PROVIDER_FACTORY","queryService","sessionService","VANTAGE_CONNECTION_PROVIDER","VantageSpooledQueryService","connectionService","translate","queryStatus","queryStatus$","queryStack","cancelLastQuery","thisQuery","deleteSpooledQuery","getRunningInfo","spooledResultSet","res","id","switchMap","exponentialBackOffInterval","toString","queryState","val","skipWhile","SpooledQueryState","take","detailMessage","message","maxInterval","returnVal","of","expand","iteration","calcInterval","interval","Math","pow","min","subscribe","err","instant","TranslateService","VANTAGE_SPOOLED_QUERY_PROVIDER_FACTORY","VANTAGE_SPOOLED_QUERY_PROVIDER","sysDatabases","VantageDictionaryService","getViewHelp","database","view","queryStr","columns","column","comment","remarks","type","columnType","name","table","viewInfo","count","ddlStatement","results","data","forEach","row","cnt","columnName","getTableHelp","info","getDatabaseFunction","funcName","join","getDatabaseFunctions","sqlHelp","indexOf","substr","split","filter","func","getAnalyticalFunctions","objectname","getAnalyticalFunction","analyticalFunction","functionName","shortDescription","longDescription","usageSyntax","inputColumns","outputColumns","stringArray","resultSetPredicate","TableName","requestText","RequestText","CommentString","kind","TableKind","getStoredProcedures","getExternalStoredProcedures","getMacros","functionsvxPredicate","DatabaseName","SpecificName","paramNumber","NumParameters","paramDataTypes","ParameterDataTypes","commentString","getTableOperators","getTableFunctions","getForeignServers","getForeignSchemas","foreignServer","Schema","getForeignTables","schema","Table","getForeignColumns","Column","Type","getDatabases","schemaname","DBKind","permSpace","PermSpace","spoolSpace","SpoolSpace","tempSpace","TempSpace","getDatabaseObjects","databaseId","tablekind","tablename","DataBaseName","databasename","getTableColumns","tableId","search","searchStr","databases","objects","queries","dbQuery","objectQuery","columnQuery","objectType","newParent","nameSplit","objectName","VANTAGE_DICTIONARY_PROVIDER_FACTORY","VANTAGE_DICTIONARY_PROVIDER","VantageCredentialsDialogComponent","_dialogRef","_connectionService","_systemService","_loadingService","_translate","_connectionAttempt$","Subject","connectionAttempt$","basicAuthEnabled","connectionType","ngOnInit","queryParams","HttpParams","systems$","retry","errorMsg","resp","systems","connect","ngOnDestroy","complete","compareSystemWith","a","b","disableClose","register","btoa","password","toPromise","close","error_1","cancel","Component","args","selector","template","MatDialogRef","VantageSystemService","TdLoadingService","VantageSQLEModule","NgModule","declarations","exports","imports","CommonModule","FormsModule","MatCardModule","MatButtonModule","MatDialogModule","MatFormFieldModule","MatInputModule","MatSelectModule","MatRadioModule","MatIconModule","CovalentLoadingModule","CovalentMessageModule","VantageSystemModule","TranslateModule","providers"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { Injectable, Provider, Optional, SkipSelf } from '@angular/core';\nimport { HttpHeaders, HttpErrorResponse } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { ISystem } from '@td-vantage/ui-platform/system';\nimport { TdHttpService } from '@covalent/http';\n\nexport interface IQueryPayload {\n  query: string;\n  session?: string;\n  logMech?: string;\n  rowOffset?: number;\n  rowLimit?: number;\n  format?: string; // (default)-object, array, or csv\n  includeColumns?: boolean;\n  includeColumnsTypes?: boolean;\n  spooledResultSet?: boolean;\n  clientId?: string;\n}\n\nexport interface IQueryResultSet {\n  queueDuration: number;\n  queryDuration: number;\n  results: IQueryResultSetResult[];\n}\n\nexport interface IQueryResultSetResult {\n  data: { [name: string]: string }[];\n  resultSet: boolean;\n  rowCount: number;\n  rowLimitExceeded: boolean;\n  columns?: { [name: string]: string }[];\n}\n\nexport interface IQueryInfo {\n  success?: boolean;\n  logTime?: string;\n  error?: any;\n  resultSet?: IQueryResultSet;\n}\n\nexport interface ISQLEConnection {\n  system: ISystem;\n  creds?: string;\n}\n\n@Injectable()\nexport class VantageQueryService {\n  constructor(private _http: TdHttpService) {}\n\n  querySystem(connection: ISQLEConnection, payload: IQueryPayload): Observable<IQueryResultSet> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n      const attributes: { [key: string]: string } = connection.system.system_attributes?.attributes;\n      payload.logMech = attributes?.log_mech || attributes?.logMech || 'DEFAULT';\n    } else {\n      payload.logMech = 'JWT';\n    }\n    payload.clientId = 'VANTAGE.EDITOR';\n    const request: Observable<object> = this._http.post(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/queries',\n      payload,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  getTableInfo(connection: ISQLEConnection, databaseName: string, tableName: string): Observable<any> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n\n    const request: Observable<object> = this._http.get(\n      `/api/query/systems/${connection.system.nickname}/databases/${databaseName}/tables/${tableName}`,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  getViewInfo(connection: ISQLEConnection, databaseName: string, viewName: string): Observable<any> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n\n    const request: Observable<object> = this._http.get(\n      `/api/query/systems/${connection.system.nickname}/databases/${databaseName}/views/${viewName}`,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  getQuery(connection: ISQLEConnection, requestId: string): Observable<any> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n    const request: Observable<object> = this._http.get(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/queries/' + requestId,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: any) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  getQueries(connection: ISQLEConnection, sessionId: string): Observable<IQueryResultSet> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n    const request: Observable<object> = this._http.get(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/queries?session=' + sessionId,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  getQueryResult(connection: ISQLEConnection, queryId: string): Observable<IQueryResultSet> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n    const request: Observable<object> = this._http.get(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/queries/' + queryId + '/results',\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  deleteQuery(connection: ISQLEConnection, queryId: string): Observable<IQueryResultSet> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n    const request: Observable<object> = this._http.delete(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/queries/' + queryId,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: IQueryResultSet) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  createSession(connection: ISQLEConnection): Observable<any> {\n    const payload: any = {\n      autoCommit: 'true',\n      transactionMode: 'TERA',\n      charSet: 'UTF8',\n    };\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n      const attributes: { [key: string]: string } = connection.system.system_attributes?.attributes;\n      payload.logMech = attributes?.log_mech || attributes?.logMech || 'DEFAULT';\n    } else {\n      payload.logMech = 'JWT';\n    }\n    const request: Observable<object> = this._http.post(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/sessions',\n      payload,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: any) => {\n        return resultSet;\n      }),\n    );\n  }\n\n  deleteSession(connection: ISQLEConnection, sessionId: string): Observable<any> {\n    let headers: HttpHeaders = new HttpHeaders()\n      .append('Accept', 'application/vnd.com.teradata.rest-v1.0+json')\n      .append('Content-Type', 'application/json');\n    if (connection.creds) {\n      headers = headers.set('X-Auth-Credentials', 'Basic ' + connection.creds);\n    }\n    const request: Observable<object> = this._http.delete(\n      '/api/query/tdrest/systems/' + connection.system.nickname + '/sessions/' + sessionId,\n      { headers },\n    );\n\n    return request.pipe(\n      catchError((error: HttpErrorResponse) => {\n        throw Object.assign({}, error.error, { httpStatus: error.status });\n      }),\n      map((resultSet: any) => {\n        return resultSet;\n      }),\n    );\n  }\n}\n\nexport function VANTAGE_QUERY_PROVIDER_FACTORY(\n  parent: VantageQueryService,\n  tdHttpService: TdHttpService,\n): VantageQueryService {\n  return parent || new VantageQueryService(tdHttpService);\n}\n\nexport const VANTAGE_QUERY_PROVIDER: Provider = {\n  // If there is already a service available, use that. Otherwise, provide a new one.\n  provide: VantageQueryService,\n  deps: [[new Optional(), new SkipSelf(), VantageQueryService], TdHttpService],\n  useFactory: VANTAGE_QUERY_PROVIDER_FACTORY,\n};\n","import { Injectable, Optional, SkipSelf, Provider } from '@angular/core';\nimport { Observable, throwError, timer, BehaviorSubject } from 'rxjs';\nimport { mergeMap, retryWhen, tap, timeout, mapTo } from 'rxjs/operators';\nimport { VantageQueryService, ISQLEConnection } from './query.service';\nimport { VantageSessionService } from '@td-vantage/ui-platform/auth';\n\nconst CONNECTION_SESSION_KEY: string = 'vantage.connection_state';\n\ninterface IVantageConnectionState {\n  current?: ISQLEConnection;\n  connections: ISQLEConnection[];\n  username: string;\n}\n\nexport interface IConnectOptions {\n  timeout: number;\n  attempts: number;\n}\n\nexport function stringify(connection: ISQLEConnection): string {\n  if (connection) {\n    return `${connection.system.nickname}${connection.creds}`;\n  }\n}\n\n@Injectable()\nexport class VantageConnectionService {\n  private readonly _currentConnectionSubject: BehaviorSubject<ISQLEConnection> = new BehaviorSubject<ISQLEConnection>(\n    this._getConnectionState().current,\n  );\n  private readonly _connectionsSubject: BehaviorSubject<ISQLEConnection[]> = new BehaviorSubject<ISQLEConnection[]>(\n    this._getConnectionState().connections,\n  );\n  public currentConnection$: Observable<ISQLEConnection> = this._currentConnectionSubject.asObservable();\n  public connections$: Observable<ISQLEConnection[]> = this._connectionsSubject.asObservable();\n\n  constructor(private _queryService: VantageQueryService, private _sessionService: VantageSessionService) {\n    const connectionState: IVantageConnectionState = this._getConnectionState();\n    if (connectionState && connectionState.username !== this._currentUsername) {\n      // mismatch, so clear\n      this._connections = [];\n      this._currentConnection = undefined;\n    }\n  }\n\n  private set _currentConnection(connection: ISQLEConnection) {\n    this._setConnectionState({\n      current: connection,\n      connections: this._connections,\n      username: this._currentUsername,\n    });\n    this._currentConnectionSubject.next(connection);\n  }\n  private get _currentConnection(): ISQLEConnection {\n    return this._currentConnectionSubject.getValue();\n  }\n  public get currentConnection(): ISQLEConnection {\n    return this._currentConnection;\n  }\n\n  private set _connections(connections: ISQLEConnection[]) {\n    this._setConnectionState({\n      current: this._currentConnection,\n      connections,\n      username: this._currentUsername,\n    });\n    this._connectionsSubject.next(connections);\n  }\n  private get _connections(): ISQLEConnection[] {\n    return this._connectionsSubject.getValue();\n  }\n  public get connections(): ISQLEConnection[] {\n    return this._connections;\n  }\n\n  public addAndSetAsCurrent(connection: ISQLEConnection, options?: IConnectOptions): Observable<ISQLEConnection> {\n    if (this._getConnectionIndex(connection) > -1) {\n      throw Error('Connection already exists');\n    } else {\n      return this._pingAndSave(connection, true, options);\n    }\n  }\n\n  public add(connection: ISQLEConnection, options?: IConnectOptions): Observable<ISQLEConnection> {\n    if (this._getConnectionIndex(connection) > -1) {\n      throw Error('Connection already exists');\n    } else {\n      return this._pingAndSave(connection, false, options);\n    }\n  }\n\n  public setAsCurrent(connection: ISQLEConnection, options?: IConnectOptions): Observable<ISQLEConnection> {\n    if (this._getConnectionIndex(connection) > -1) {\n      return this._pingAndSave(connection, true, options);\n    } else {\n      throw Error('Connection does not exist');\n    }\n  }\n\n  public remove(connection: ISQLEConnection): ISQLEConnection {\n    const index: number = this._getConnectionIndex(connection);\n    if (index > -1) {\n      this._connections = [...this._connections.slice(0, index), ...this._connections.slice(index + 1)];\n      this._currentConnection =\n        this._currentConnection && this._areEqual(this._currentConnection, connection)\n          ? undefined\n          : this._currentConnection;\n      return connection;\n    } else {\n      // connection does not exist but that is fine?\n      return undefined;\n    }\n  }\n\n  public unsetAsCurrent(): void {\n    this._currentConnection = undefined;\n  }\n\n  public removeAll(): void {\n    this._connections = [];\n    this._currentConnection = undefined;\n  }\n\n  public exists(connection: ISQLEConnection): boolean {\n    return this._getConnectionIndex(connection) > -1;\n  }\n\n  public isCurrent(connection: ISQLEConnection): boolean {\n    return this._areEqual(connection, this.currentConnection);\n  }\n\n  public stringify(connection: ISQLEConnection): string {\n    return stringify(connection);\n  }\n\n  private _pingAndSave(\n    connection: ISQLEConnection,\n    setAsCurrent: boolean,\n    opts?: IConnectOptions,\n  ): Observable<ISQLEConnection> {\n    // test connection with SELECT 1\n    return this._queryService.querySystem(connection, { query: 'SELECT 1;' }).pipe(\n      // timeout connection if more than 7 seconds\n      timeout(opts?.timeout || 7000),\n      // retry only after a certain number of attempts or if the error is something else than 420\n      retryWhen((errors: Observable<{ httpStatus: number }>) => {\n        return errors.pipe(\n          mergeMap((error: { httpStatus: number }, index: number) => {\n            const retryAttempt: number = index + 1;\n            if (retryAttempt > (opts?.attempts || 2) || error.httpStatus === 420) {\n              return throwError(error);\n            }\n            return timer(0);\n          }),\n        );\n      }),\n      tap(() => {\n        // if successful, save\n        const index: number = this._getConnectionIndex(connection);\n        if (index === -1) {\n          this._connections = [...this._connections, connection];\n        }\n        if (setAsCurrent) {\n          this._currentConnection = connection;\n        }\n      }),\n      mapTo(connection),\n    );\n  }\n\n  private get _currentUsername(): string {\n    return this._sessionService.user && this._sessionService.user.username;\n  }\n\n  private _areEqual(connectionA: ISQLEConnection, connectionB: ISQLEConnection): boolean {\n    return connectionA.creds === connectionB.creds && connectionA.system.nickname === connectionB.system.nickname;\n  }\n\n  private _getConnectionIndex(connection: ISQLEConnection): number {\n    return this.connections.findIndex((conn: ISQLEConnection) => this._areEqual(connection, conn));\n  }\n\n  private _getConnectionState(): IVantageConnectionState {\n    try {\n      const connectionState: IVantageConnectionState = JSON.parse(sessionStorage.getItem(CONNECTION_SESSION_KEY));\n      if (connectionState) {\n        return connectionState;\n      }\n      return {\n        username: undefined,\n        current: undefined,\n        connections: [],\n      };\n    } catch {\n      return {\n        username: undefined,\n        current: undefined,\n        connections: [],\n      };\n    }\n  }\n\n  private _setConnectionState(connectionState: IVantageConnectionState): void {\n    sessionStorage.setItem(CONNECTION_SESSION_KEY, JSON.stringify(connectionState));\n  }\n}\n\nexport function VANTAGE_CONNECTION_PROVIDER_FACTORY(\n  parent: VantageConnectionService,\n  queryService: VantageQueryService,\n  sessionService: VantageSessionService,\n): VantageConnectionService {\n  return parent || new VantageConnectionService(queryService, sessionService);\n}\n\nexport const VANTAGE_CONNECTION_PROVIDER: Provider = {\n  // If there is already a service available, use that. Otherwise, provide a new one.\n  provide: VantageConnectionService,\n  deps: [[new Optional(), new SkipSelf(), VantageConnectionService], VantageQueryService, VantageSessionService],\n  useFactory: VANTAGE_CONNECTION_PROVIDER_FACTORY,\n};\n","import { Injectable, Provider, Optional, SkipSelf } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { TranslateService } from '@ngx-translate/core';\nimport { catchError, expand, map, mapTo, skipWhile, switchMap, take, tap } from 'rxjs/operators';\nimport { BehaviorSubject, Observable, of, throwError, timer } from 'rxjs';\nimport { VantageConnectionService } from './connection.service';\nimport { VantageQueryService, IQueryPayload, IQueryResultSet } from './query.service';\n\ninterface ISpooledQueryError extends HttpErrorResponse {\n  id: string;\n  detailMessage: string;\n}\n\nconst MAX_INTERVAL: number = 10000;\nconst BASE_INTERVAL: number = 2000;\n\nenum SpooledQueryState {\n  QUEUED = 'QUEUED',\n  PENDING = 'PENDING',\n  SUBMITTED = 'SUBMITTED',\n  RESPONDING = 'RESPONDING',\n  SPOOLING = 'SPOOLING',\n  RESULT_SET_READY = 'RESULT_SET_READY',\n}\n\n@Injectable()\nexport class VantageSpooledQueryService {\n  queryStatus: BehaviorSubject<SpooledQueryState> = new BehaviorSubject<SpooledQueryState>(undefined);\n  queryStatus$: Observable<SpooledQueryState> = this.queryStatus.asObservable();\n  queryStack: string[] = [];\n  constructor(\n    private connectionService: VantageConnectionService,\n    private queryService: VantageQueryService,\n    private translate: TranslateService,\n  ) {}\n\n  cancelLastQuery(): void {\n    const thisQuery: string = this.queryStack.pop();\n\n    return this.deleteSpooledQuery(thisQuery);\n  }\n\n  getRunningInfo(): Observable<SpooledQueryState> {\n    return this.queryStatus$;\n  }\n\n  querySystem(payload: IQueryPayload): Observable<IQueryResultSet> {\n    return this.queryService\n      .querySystem(this.connectionService.currentConnection, { ...payload, spooledResultSet: true })\n      .pipe(\n        tap((res: any) => this.queryStack.push(res.id)),\n        switchMap((res: any) => this.exponentialBackOffInterval(MAX_INTERVAL, res.id)),\n        switchMap((id: number) =>\n          this.queryService.getQuery(this.connectionService.currentConnection, id.toString()).pipe(\n            map((query: any) => query.queryState),\n            tap((val: any) => this.queryStatus.next(val)),\n            map((val: any) => [id, val]),\n          ),\n        ),\n        skipWhile(([id, status]: [string, SpooledQueryState]) => status !== SpooledQueryState.RESULT_SET_READY),\n        take(1),\n        switchMap(([id]: [string, SpooledQueryState]) =>\n          this.queryService.getQueryResult(this.connectionService.currentConnection, id).pipe(\n            map((val: IQueryResultSet) => [id, val]),\n            tap(() => this.queryStack.pop()),\n            catchError((res: HttpErrorResponse) => {\n              return throwError({\n                ...res,\n                ...{ id },\n                detailMessage: `Error ${res.error.error}: ${res.error.message}`,\n              } as ISpooledQueryError);\n            }),\n          ),\n        ),\n        map(([id, results]: [string, IQueryResultSet]) => results),\n      );\n  }\n\n  exponentialBackOffInterval(maxInterval: number, returnVal: any): Observable<number> {\n    return of(0).pipe(\n      expand((iteration: number) => timer(this.calcInterval(iteration, maxInterval)).pipe(mapTo(iteration + 1))),\n      mapTo(returnVal),\n    );\n  }\n\n  calcInterval(iteration: number, maxInterval: number): number {\n    const expo: number = 1.4;\n    const interval: number = Math.pow(expo, iteration) * BASE_INTERVAL;\n\n    return Math.min(interval, maxInterval);\n  }\n\n  deleteSpooledQuery(queryId: string): void {\n    this.queryService\n      .deleteQuery(this.connectionService.currentConnection, queryId)\n      .subscribe(undefined, (err: Error) => {\n        throw new Error(this.translate.instant('SPOOLED_QUERY_COULD_NOT_BE_DELETED', { error: JSON.stringify(err) }));\n      });\n  }\n}\n\nexport function VANTAGE_SPOOLED_QUERY_PROVIDER_FACTORY(\n  parent: VantageSpooledQueryService,\n  connectionService: VantageConnectionService,\n  queryService: VantageQueryService,\n  translate: TranslateService,\n): VantageSpooledQueryService {\n  return parent || new VantageSpooledQueryService(connectionService, queryService, translate);\n}\n\nexport const VANTAGE_SPOOLED_QUERY_PROVIDER: Provider = {\n  // If there is already a service available, use that. Otherwise, provide a new one.\n  provide: VantageSpooledQueryService,\n  deps: [\n    [new Optional(), new SkipSelf(), VantageSpooledQueryService],\n    VantageConnectionService,\n    VantageQueryService,\n    TranslateService,\n  ],\n  useFactory: VANTAGE_SPOOLED_QUERY_PROVIDER_FACTORY,\n};\n","import { Injectable, SkipSelf, Optional, Provider } from '@angular/core';\n\nimport { Observable } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\n\nimport { VantageQueryService, IQueryResultSet, ISQLEConnection } from './query.service';\n\nexport const sysDatabases: string[] = [\n  'DBC',\n  'dbcmngr',\n  'SQLJ',\n  'SystemFe',\n  'SysAdmin',\n  'SYSBAR',\n  'SYSJDBC',\n  'SYSLIB',\n  'SYSUDTLIB',\n  'TDMaps',\n  'TD_SERVER_DB',\n  'TD_SYSFNLIB',\n  'TD_SYSXML',\n  'Sys_Calendar',\n];\n\nexport interface IDictionarySystem {\n  hostname?: string;\n  password?: string;\n  port?: number;\n  system_id?: string;\n  last_run?: string;\n  interval_minutes?: number;\n  enabled?: boolean;\n  last_attempt?: string;\n  in_collection?: boolean;\n  username?: string;\n}\n\nexport interface IDictionaryDatabase {\n  parent_name?: string;\n  size_bytes?: number;\n  system_id?: string;\n  name?: string;\n  id?: string;\n  type?: string;\n}\n\nexport interface IDictionaryDatabaseObject {\n  system_id?: string;\n  database_id?: string;\n  id?: string;\n  name?: string;\n  size_bytes?: number;\n  type?: string;\n  create_text?: string;\n}\n\nexport interface IDictionaryTableColumn {\n  system_id?: string;\n  database_id?: string;\n  table_id?: string;\n  id?: string;\n  name?: string;\n}\n\n/**\n * FunctionType\n * A - Aggregate\n * B - Aggregate and statistical\n * C - Contract function\n * D - External stored procedure\n * F - Scalar\n * H - User defined method\n * I - Internal type method\n * L - Table operator\n * R - Table Function\n * S - Statistical\n */\n\n/**\n * TableKind for dbc.tablesvx;\n * A - Aggregate function\n * B - Combined aggregate and ordered analytical function\n * C - Table operator parser contract function\n * D - JAR\n * E - External Stored Procedure\n * F - Standard Function\n * G - Trigger\n * H - Instance or contructor method\n * I - Join Index\n * J - Journal\n * K - Foreign Server Object\n * L - User defined table operator\n * M - Macro\n * N - Hash index\n * O - Table with no primary index and no partitioning\n * P - Stored Procedure\n * Q - Queue table\n * R - Table function\n * S - Ordered Analytical function\n * T - table with a primary index or primary AMP index, partitioning or both. Or a partioned table with NoPI;\n * U - User defined type\n * V - View\n * X - Authorization\n * Y - GLOP set\n * Z - UIF - User Installed File\n * 1 - A DATASET schema object created by CREATE SCHEMA\n * 2 - Functon alias object\n */\n\n/**\n * dbc.externalSPs\n * dbc.sessionInfovx\n */\n\n@Injectable()\nexport class VantageDictionaryService {\n  constructor(private _queryService: VantageQueryService) {}\n\n  getViewHelp(connection: ISQLEConnection, database: string, view: string): Observable<any> {\n    const queryStr: string = `\n      LOCK ROW FOR ACCESS\n      SELECT CAST(COUNT(*) AS BIGINT) as cnt\n      FROM ${database}.${view};\n      SHOW VIEW ${database}.${view};\n    `;\n\n    return this._queryService.getViewInfo(connection, database, view).pipe(\n      map((resultSet: any) => {\n        return resultSet.columns.map((column: any) => {\n          return {\n            comment: column.remarks,\n            type: 'column',\n            columnType: column.type,\n            name: column.name,\n            database: resultSet.database,\n            table: resultSet.name,\n          };\n        });\n      }),\n      switchMap((viewInfo: any) => {\n        return this._queryService\n          .querySystem(connection, {\n            query: queryStr,\n          })\n          .pipe(\n            map((resultSet: IQueryResultSet) => {\n              let ddlStatement: string = '';\n              resultSet.results[1].data.forEach((row: any) => {\n                ddlStatement += row['Request Text'];\n              });\n              let count: string;\n              resultSet.results[0].data.forEach((row: any) => {\n                count = row.cnt;\n              });\n\n              const columns: any[] = viewInfo.map((row: any) => {\n                return {\n                  columnName: row.name,\n                  type: row.columnType,\n                };\n              });\n\n              return {\n                database,\n                view,\n                columns,\n                count,\n                ddlStatement,\n              };\n            }),\n          );\n      }),\n    );\n  }\n\n  getTableHelp(connection: ISQLEConnection, database: string, table: string): Observable<any> {\n    const queryStr: string = `\n      LOCK ROW FOR ACCESS\n      SELECT CAST(COUNT(*) AS BIGINT) as cnt\n      FROM ${database}.${table};\n      SHOW TABLE ${database}.${table};\n    `;\n    return this._queryService.getTableInfo(connection, database, table).pipe(\n      map((resultSet: any) => {\n        return resultSet.columns.map((column: any) => {\n          return {\n            comment: column.remarks,\n            type: 'column',\n            columnType: column.type,\n            name: column.name,\n            database: resultSet.database,\n            table: resultSet.name,\n          };\n        });\n      }),\n      switchMap((info: any) => {\n        return this._queryService\n          .querySystem(connection, {\n            query: queryStr,\n          })\n          .pipe(\n            map((resultSet: IQueryResultSet) => {\n              let ddlStatement: string = '';\n              resultSet.results[1].data.forEach((row: any) => {\n                ddlStatement += row['Request Text'];\n              });\n              let count: string;\n              resultSet.results[0].data.forEach((row: any) => {\n                count = row.cnt;\n              });\n              const columns: any[] = info.map((row: any) => {\n                return {\n                  columnName: row.name,\n                  type: row.columnType,\n                };\n              });\n              return {\n                database,\n                table,\n                columns,\n                count,\n                ddlStatement,\n              };\n            }),\n          );\n      }),\n    );\n  }\n\n  getDatabaseFunction(connection: ISQLEConnection, funcName: string): Observable<any> {\n    const queryStr: string = `\n      HELP 'SQL ${funcName}';\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          const stringArray: string[] = resultSet.results[0].data.map((row: any) => {\n            return row['On-Line Help'];\n          });\n          return stringArray.join(' ');\n        }),\n      );\n  }\n\n  getDatabaseFunctions(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      HELP 'SQL';\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          const stringArray: string[] = resultSet.results[0].data.map((row: any) => {\n            return row['On-Line Help'];\n          });\n          let sqlHelp: string = stringArray.join(' ');\n          const index: number = sqlHelp.indexOf('FUNCTIONS') + 12;\n          sqlHelp = sqlHelp.substr(index, sqlHelp.length);\n          return sqlHelp\n            .split(' ')\n            .filter((func: string) => {\n              return func;\n            })\n            .map((func: string) => {\n              return {\n                name: func,\n              };\n            });\n        }),\n      );\n  }\n\n  getAnalyticalFunctions(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      HELP FOREIGN SCHEMA \"public\"@coprocessor;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: any) => {\n            return {\n              name: row.objectname,\n            };\n          });\n        }),\n      );\n  }\n\n  getAnalyticalFunction(connection: ISQLEConnection, analyticalFunction: string): Observable<any> {\n    const queryStr: string = `\n      HELP FOREIGN FUNCTION \"public\".\"${analyticalFunction}\"@coprocessor;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          let functionName: string = '';\n          let shortDescription: string = '';\n          let longDescription: string = '';\n          let usageSyntax: string = '';\n          let inputColumns: string = '';\n          let outputColumns: string = '';\n          const functionOwner: string = '';\n          const creationTime: string = '';\n          const functionVersion: string = '';\n          const interfacesImplemented: string = '';\n          const stringArray: string[] = resultSet.results[0].data.map((row: any) => {\n            return row['Function Help'];\n          });\n          for (let index: number = 0; index < stringArray.length; index++) {\n            const value: string = stringArray[index];\n            if (value.indexOf('Function Name:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                functionName += stringArray[index] + '\\n';\n              }\n            } else if (value.indexOf('Short Description:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                shortDescription += stringArray[index] + '\\n';\n              }\n            } else if (value.indexOf('Long Description:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                longDescription += stringArray[index] + '\\n';\n              }\n            } else if (value.indexOf('Usage Syntax:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                usageSyntax += stringArray[index] + '\\n';\n              }\n            } else if (value.indexOf('Input Columns:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                inputColumns += stringArray[index] + '\\n';\n              }\n            } else if (value.indexOf('Output Columns:') > -1) {\n              for (index++; index < stringArray.indexOf(''); index++) {\n                outputColumns += stringArray[index] + '\\n';\n              }\n            } else {\n              // Function Owner:\n              // Creation Time:\n              // Function Version:\n              // Interfaces Implemented:\n              if (stringArray.indexOf('') > -1) {\n                index = stringArray.indexOf('');\n                stringArray[index] = undefined;\n              }\n            }\n          }\n          return {\n            functionName,\n            shortDescription,\n            longDescription,\n            usageSyntax,\n            inputColumns,\n            outputColumns,\n          };\n        }),\n      );\n  }\n\n  resultSetPredicate(resultSet: IQueryResultSet): any {\n    return resultSet.results[0].data.map((row: any) => {\n      return {\n        name: row.TableName,\n        requestText: row.RequestText,\n        comment: row.CommentString,\n        kind: row.TableKind,\n      };\n    });\n  }\n\n  getStoredProcedures(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'P'\n      ORDER BY TableName ASC;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(map(this.resultSetPredicate));\n  }\n\n  getExternalStoredProcedures(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'E'\n      ORDER BY TableName ASC;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(map(this.resultSetPredicate));\n  }\n\n  getMacros(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'M'\n      ORDER BY TableName ASC;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(map(this.resultSetPredicate));\n  }\n\n  functionsvxPredicate(resultSet: IQueryResultSet): any {\n    return resultSet.results[0].data.map((row: any) => {\n      return {\n        database: row.DatabaseName,\n        name: row.SpecificName,\n        paramNumber: row.NumParameters,\n        paramDataTypes: row.ParameterDataTypes,\n        requestText: row.RequestText,\n        commentString: row.CommentString,\n        kind: row.TableKind,\n      };\n    });\n  }\n\n  getTableOperators(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      SELECT func.DatabaseName, func.FunctionName, func.SpecificName, func.NumParameters,\n      func.ParameterDataTypes, tbl.RequestText, tbl.CommentString, tbl.TableKind\n      FROM dbc.functionsvx as func\n      INNER JOIN dbc.tablesvx as tbl\n      ON tbl.TableName = func.SpecificName\n      AND tbl.DataBaseName = func.DatabaseName\n      WHERE FunctionType = 'L'\n      ORDER BY func.FunctionName ASC;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(map(this.functionsvxPredicate));\n  }\n\n  getTableFunctions(connection: ISQLEConnection): Observable<any> {\n    const queryStr: string = `\n      SELECT func.DatabaseName, func.FunctionName, func.SpecificName, func.NumParameters,\n      func.ParameterDataTypes, tbl.RequestText, tbl.CommentString, tbl.TableKind\n      FROM dbc.functionsvx as func\n      INNER JOIN dbc.tablesvx as tbl\n      ON tbl.TableName = func.SpecificName\n      AND tbl.DataBaseName = func.DatabaseName\n      WHERE FunctionType = 'R'\n      ORDER BY func.FunctionName ASC;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(map(this.functionsvxPredicate));\n  }\n\n  getForeignServers(connection: ISQLEConnection): Observable<any[]> {\n    const queryStr: string = `\n      SELECT TableName, TableKind FROM DBC.TABLESVX\n      WHERE DATABASENAME = 'TD_SERVER_DB' AND\n      TABLEKIND = 'K' AND\n      TableName <> 'coprocesor';\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: any) => {\n            return {\n              name: row.TableName,\n              kind: row.TableKind,\n            };\n          });\n        }),\n      );\n  }\n\n  getForeignSchemas(connection: ISQLEConnection, foreignServer: string): Observable<any[]> {\n    const queryStr: string = `\n      HELP FOREIGN SERVER ${foreignServer};\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: { Schema: string }) => {\n            return {\n              name: row.Schema,\n              kind: 'NONE',\n            };\n          });\n        }),\n      );\n  }\n\n  getForeignTables(connection: ISQLEConnection, foreignServer: string, schema: string): Observable<any[]> {\n    const queryStr: string = `\n      HELP FOREIGN DATABASE \"${schema}\"@${foreignServer};\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: { Table: string }) => {\n            return {\n              name: row.Table,\n              kind: 'NONE',\n            };\n          });\n        }),\n      );\n  }\n\n  getForeignColumns(\n    connection: ISQLEConnection,\n    foreignServer: string,\n    schema: string,\n    table: string,\n  ): Observable<any[]> {\n    const queryStr: string = `\n      HELP FOREIGN TABLE \"${schema}\".\"${table}\"@${foreignServer};\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: { Column: string; Type: string }) => {\n            return {\n              name: row.Column,\n              type: row.Type,\n            };\n          });\n        }),\n      );\n  }\n\n  getDatabases(connection: ISQLEConnection): Observable<any[]> {\n    const queryStr: string =\n      'SELECT databasename, PermSpace, SpoolSpace, TempSpace, CommentString, DBKind FROM dbc.databasesVX ORDER BY databasename;';\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: any) => {\n            return {\n              name: row.DatabaseName || row.schemaname,\n              type: row.DBKind === 'U' ? 'user' : 'database',\n              permSpace: row.PermSpace,\n              spoolSpace: row.SpoolSpace,\n              tempSpace: row.TempSpace,\n              comment: row.CommentString,\n            };\n          });\n        }),\n      );\n  }\n\n  getDatabaseObjects(connection: ISQLEConnection, databaseId: string): Observable<any[]> {\n    const queryStr: string = `SELECT DataBaseName, TableName, TableKind, CommentString FROM dbc.tablesvx\n       WHERE TableKind in ('T', 'O', 'V') AND DataBaseName = '${databaseId}' ORDER BY TableName ASC;`;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: any) => {\n            const type: string = row.TableKind || row.tablekind;\n            return {\n              kind: row.TableKind || row.tablekind,\n              type: type === 'V' ? 'view' : 'table',\n              name: row.TableName || row.tablename,\n              database: row.DataBaseName || row.databasename,\n              comment: row.CommentString,\n            };\n          });\n        }),\n      );\n  }\n\n  getTableColumns(type: string, connection: ISQLEConnection, databaseId: string, tableId: string): Observable<any> {\n    if (type === 'table') {\n      return this._queryService.getTableInfo(connection, databaseId, tableId).pipe(\n        map((resultSet: any) => {\n          return resultSet.columns.map((column: any) => {\n            return {\n              comment: column.remarks,\n              type: 'column',\n              columnType: column.type,\n              name: column.name,\n              database: resultSet.database,\n              table: resultSet.name,\n            };\n          });\n        }),\n      );\n    } else if (type === 'view') {\n      return this._queryService.getViewInfo(connection, databaseId, tableId).pipe(\n        map((resultSet: any) => {\n          return resultSet.columns.map((column: any) => {\n            return {\n              comment: column.remarks,\n              type: 'column',\n              columnType: column.type,\n              name: column.name,\n              database: resultSet.database,\n              table: resultSet.name,\n            };\n          });\n        }),\n      );\n    }\n  }\n\n  search(\n    connection: ISQLEConnection,\n    searchStr: string,\n    options: {\n      databases: boolean;\n      objects: boolean;\n      columns: boolean;\n    } = {\n      databases: true,\n      objects: true,\n      columns: true,\n    },\n  ): Observable<any[]> {\n    const queries: string[] = [];\n    if (options.databases) {\n      const dbQuery: string = `\n        SELECT\n            DatabaseName as objectName,\n            'database' as objectType,\n            DBKind as kind,\n            CommentString\n        FROM dbc.databasesvx\n        WHERE DatabaseName LIKE '%${searchStr}%'\n        AND DataBaseName NOT IN ('${sysDatabases.join(\"', '\")}')\n      `;\n      queries.push(dbQuery);\n    }\n    if (options.objects) {\n      const objectQuery: string = `\n        SELECT\n            DataBaseName || '~|~' || TableName as objectName,\n            'object' as objectType,\n            TableKind as kind,\n            CommentString\n        FROM dbc.tablesvx\n        WHERE TableKind in ('T', 'O', 'V')\n        AND TableName LIKE '%${searchStr}%'\n        AND DataBaseName NOT IN ('${sysDatabases.join(\"', '\")}')\n      `;\n      queries.push(objectQuery);\n    }\n    if (options.objects) {\n      const columnQuery: string = `\n        SELECT\n            DataBaseName || '~|~' || TableName || '~|~' || ColumnName as objectName,\n            'column' as objectType,\n            ColumnType as kind,\n            CommentString\n        FROM dbc.columnsVX\n        WHERE columnname LIKE '%${searchStr}%'\n        AND DataBaseName NOT IN ('${sysDatabases.join(\"', '\")}')\n      `;\n      queries.push(columnQuery);\n    }\n    const unionJoin: string = queries.join('UNION');\n    const queryStr: string = `\n      WITH quick_search AS (\n          ${unionJoin}\n      )\n      SELECT * FROM quick_search\n      ORDER BY 1\n      SAMPLE 100;\n    `;\n    return this._queryService\n      .querySystem(connection, {\n        query: queryStr,\n      })\n      .pipe(\n        map((resultSet: IQueryResultSet) => {\n          return resultSet.results[0].data.map((row: any) => {\n            let kind: string = row.kind;\n            // map to proper type/kind\n            if (row.objectType === 'column') {\n              kind = 'column';\n            } else if (row.objectType === 'database') {\n              kind = kind === 'D' ? 'database' : 'user';\n            } else {\n              kind = kind === 'V' ? 'view' : 'table';\n            }\n            const newParent: string[] = [];\n            // split name and parents..\n            const nameSplit: string[] = row.objectName.split('~|~');\n            for (let index: number = 0; index < nameSplit.length - 1; index++) {\n              newParent.push('\"' + nameSplit[index] + '\"');\n            }\n            return {\n              parent: newParent.join('.'),\n              name: nameSplit[nameSplit.length - 1],\n              kind,\n              type: row.objectType,\n              comment: row.CommentString,\n            };\n          });\n        }),\n      );\n  }\n}\n\nexport function VANTAGE_DICTIONARY_PROVIDER_FACTORY(\n  parent: VantageDictionaryService,\n  queryService: VantageQueryService,\n): VantageDictionaryService {\n  return parent || new VantageDictionaryService(queryService);\n}\n\nexport const VANTAGE_DICTIONARY_PROVIDER: Provider = {\n  // If there is already a service available, use that. Otherwise, provide a new one.\n  provide: VantageDictionaryService,\n  deps: [[new Optional(), new SkipSelf(), VantageDictionaryService], VantageQueryService],\n  useFactory: VANTAGE_DICTIONARY_PROVIDER_FACTORY,\n};\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { HttpParams } from '@angular/common/http';\n\nimport { MatDialogRef } from '@angular/material/dialog';\n\nimport { TdLoadingService } from '@covalent/core/loading';\n\nimport { ISystem, VantageSystemService } from '@td-vantage/ui-platform/system';\nimport { VantageConnectionService } from '../connection.service';\nimport { ISQLEConnection } from '../query.service';\n\nimport { Observable, Subject, of } from 'rxjs';\nimport { retry, map, tap, catchError } from 'rxjs/operators';\n\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'vui-sqle-credentials-dialog',\n  templateUrl: './credentials-dialog.component.html',\n  styleUrls: ['./credentials-dialog.component.scss'],\n})\nexport class VantageCredentialsDialogComponent implements OnInit, OnDestroy {\n  // listens to times we try to connect regardless\n  private _connectionAttempt$: Subject<void> = new Subject<void>();\n  connectionAttempt$: Observable<void> = this._connectionAttempt$.asObservable();\n\n  basicAuthEnabled: boolean = false;\n  systems$: Observable<ISystem[]>;\n\n  system: ISystem;\n  connectionType: boolean = false;\n  username: string;\n  password: string;\n\n  errorMsg: string;\n\n  constructor(\n    private _dialogRef: MatDialogRef<VantageCredentialsDialogComponent>,\n    private _connectionService: VantageConnectionService,\n    private _systemService: VantageSystemService,\n    private _loadingService: TdLoadingService,\n    private _translate: TranslateService,\n  ) {}\n\n  ngOnInit(): void {\n    // prepopulate connection type\n    this.connectionType = this.basicAuthEnabled;\n    // prep systems observable\n    let queryParams: HttpParams = new HttpParams();\n    queryParams = queryParams.append('systemType', 'TERADATA');\n    this.systems$ = this._systemService.query(queryParams).pipe(\n      retry(2),\n      catchError(() => {\n        this.errorMsg = this._translate.instant('ERROR_RETRIEVE_DATA');\n        return of({ data: [] });\n      }),\n      map((resp: { data: ISystem[] }) => resp.data),\n      tap((systems: ISystem[]) => {\n        if (systems && systems.length) {\n          // select first system by default if no system was prepopulated\n          if (!this.system) {\n            this.system = systems[0];\n          }\n          // if there is only one system and basic auth disabled, we try to connect to it automagically\n          if (systems.length === 1 && !this.basicAuthEnabled) {\n            this.connect();\n          }\n        }\n      }),\n    );\n  }\n\n  ngOnDestroy(): void {\n    // finallize subject\n    this._connectionAttempt$.complete();\n  }\n\n  compareSystemWith(a: ISystem, b: ISystem): boolean {\n    return a && b && a.nickname === b.nickname;\n  }\n\n  async connect(): Promise<void> {\n    try {\n      this.errorMsg = undefined;\n      // block users from closing the dialog while connecting\n      this._dialogRef.disableClose = true;\n      this._loadingService.register('system.connect');\n      const connection: ISQLEConnection = this.connectionType\n        ? { system: this.system, creds: btoa(this.username + ':' + this.password) }\n        : { system: this.system };\n\n      if (this._connectionService.exists(connection)) {\n        await this._connectionService.setAsCurrent(connection).toPromise();\n      } else {\n        await this._connectionService.addAndSetAsCurrent(connection).toPromise();\n      }\n\n      this._dialogRef.close(connection);\n    } catch (error) {\n      this.errorMsg = error.message;\n    } finally {\n      this._connectionAttempt$.next();\n      // allow users to close dialog again\n      this._dialogRef.disableClose = false;\n      this._loadingService.resolve('system.connect');\n    }\n  }\n\n  cancel(): void {\n    this._dialogRef.close();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatCardModule } from '@angular/material/card';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { CovalentLoadingModule } from '@covalent/core/loading';\nimport { CovalentMessageModule } from '@covalent/core/message';\n\nimport { VantageSystemModule } from '@td-vantage/ui-platform/system';\n\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { VANTAGE_CONNECTION_PROVIDER } from './connection.service';\nimport { VANTAGE_DICTIONARY_PROVIDER } from './dictionary.service';\nimport { VANTAGE_QUERY_PROVIDER } from './query.service';\nimport { VANTAGE_SPOOLED_QUERY_PROVIDER } from './spooled-query.service';\n\nimport { VantageCredentialsDialogComponent } from './credentials-dialog/credentials-dialog.component';\n\n@NgModule({\n  declarations: [VantageCredentialsDialogComponent],\n  exports: [VantageCredentialsDialogComponent],\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatCardModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatRadioModule,\n    MatIconModule,\n    CovalentLoadingModule,\n    CovalentMessageModule,\n    VantageSystemModule,\n    TranslateModule,\n  ],\n  providers: [\n    VANTAGE_CONNECTION_PROVIDER,\n    VANTAGE_DICTIONARY_PROVIDER,\n    VANTAGE_QUERY_PROVIDER,\n    VANTAGE_SPOOLED_QUERY_PROVIDER,\n  ],\n})\nexport class VantageSQLEModule {}\n"]}