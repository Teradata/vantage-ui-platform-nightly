{"version":3,"sources":["ng://@td-vantage/ui-platform/testing/cypress/cypress.ts"],"names":["BASE_URL","Cypress","config","LOGIN_URL","env","_redirectToHome","cy","visit","url","should","_a","username","password","request","then","response","loginPageHtml","document","createElement","innerHTML","body","loginForm","querySelector","form","method","action","followRedirect"],"mappings":"kdAEMA,EAAmBC,QAAQC,OAAO,WAClCC,EAAoBF,QAAQG,IAAI,YAsCtC,SAASC,IACPC,GAAGC,MAAMP,GACTM,GAAGE,MAAMC,OAAO,cAAeN,GAC/BG,GAAGE,MAAMC,OAAO,UAAWT,WAjC7B,SAAsBU,OAAEC,EAAAD,EAAAC,SAAUC,EAAAF,EAAAE,SAChCN,GAAGO,QAAQ,CACTL,IAAKL,IACJW,MAAI,SAAEC,OACDC,EAA6BC,SAASC,cAAc,QAC1DF,EAAcG,UAAYJ,EAASK,SAC7BC,EAA6BL,EAAcM,cAAc,kBAC3DD,EACFf,GAAGO,QAAQ,CACTU,MAAM,EACNC,OAAQ,OACRhB,IAAKa,EAAUI,OACfC,gBAAgB,EAChBN,KAAM,CACJT,SAAQA,EACRC,SAAQA,KAETE,MAAI,WACLT,OAGFA,iBAKN,WACEC,GAAGO,QAAQ","sourcesContent":["/// <reference types=\"cypress\" />\n\nconst BASE_URL: string = Cypress.config('baseUrl'); // ex: http://localhost:4200\nconst LOGIN_URL: string = Cypress.env('loginUrl'); // ex: https://vantage.url.io/auth\n\nexport interface ILoginCredentials {\n  username: string;\n  password: string;\n}\n\n// inspired by https://vrockai.github.io/blog/2017/10/28/cypress-keycloak-intregration/\nexport function login({ username, password }: ILoginCredentials): void {\n  cy.request({\n    url: LOGIN_URL,\n  }).then((response: any) => {\n    const loginPageHtml: HTMLElement = document.createElement('html');\n    loginPageHtml.innerHTML = response.body;\n    const loginForm: HTMLFormElement = loginPageHtml.querySelector('#kc-form-login');\n    if (loginForm) {\n      cy.request({\n        form: true,\n        method: 'POST',\n        url: loginForm.action,\n        followRedirect: false,\n        body: {\n          username,\n          password,\n        },\n      }).then(() => {\n        _redirectToHome();\n      });\n    } else {\n      _redirectToHome();\n    }\n  });\n}\n\nexport function logout(): void {\n  cy.request('/api/user/logout');\n}\n\nfunction _redirectToHome(): void {\n  cy.visit(BASE_URL);\n  cy.url().should('not.include', LOGIN_URL);\n  cy.url().should('include', BASE_URL);\n}\n"]}