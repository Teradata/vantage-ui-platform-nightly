{"version":3,"file":"td-vantage-ui-platform-theme.js","sources":["ng://@td-vantage/ui-platform/theme/theme.service.ts","ng://@td-vantage/ui-platform/theme/theme.module.ts"],"sourcesContent":["import { Injectable, Renderer2, Inject, RendererFactory2, Provider, Optional, SkipSelf } from '@angular/core';\nimport { fromEvent, BehaviorSubject, Observable } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport { DOCUMENT } from '@angular/common';\n\nconst THEME_LOCAL_STORAGE_KEY: string = 'vantage.theme';\n\nexport enum VantageTheme {\n  DARK = 'dark-theme',\n  LIGHT = 'light-theme',\n}\n\nexport interface IVantageThemeMap {\n  [VantageTheme.DARK]?: any;\n  [VantageTheme.LIGHT]?: any;\n}\n\n@Injectable()\nexport class VantageThemeService {\n  private _renderer2: Renderer2;\n\n  private readonly _activeThemeSubject: BehaviorSubject<VantageTheme> = new BehaviorSubject<VantageTheme>(\n    <VantageTheme>localStorage.getItem(THEME_LOCAL_STORAGE_KEY),\n  );\n\n  public readonly activeTheme$: Observable<VantageTheme> = this._activeThemeSubject.asObservable();\n  public readonly darkTheme$: Observable<boolean> = this._activeThemeSubject\n    .asObservable()\n    .pipe(map((theme: VantageTheme) => theme === VantageTheme.DARK));\n  public readonly lightTheme$: Observable<boolean> = this._activeThemeSubject\n    .asObservable()\n    .pipe(map((theme: VantageTheme) => theme === VantageTheme.LIGHT));\n\n  constructor(private rendererFactory: RendererFactory2, @Inject(DOCUMENT) private _document: any) {\n    this._renderer2 = rendererFactory.createRenderer(undefined, undefined);\n    fromEvent(window, 'storage')\n      .pipe(filter((event: StorageEvent) => event.key === THEME_LOCAL_STORAGE_KEY))\n      .subscribe((event: StorageEvent) => this.applyTheme(<VantageTheme>event.newValue));\n  }\n\n  private get _activeTheme(): VantageTheme {\n    return this._activeThemeSubject.getValue();\n  }\n\n  private set _activeTheme(theme: VantageTheme) {\n    this._activeThemeSubject.next(theme);\n  }\n\n  public get darkThemeIsActive(): boolean {\n    return this._activeTheme === VantageTheme.DARK;\n  }\n  public get lightThemeIsActive(): boolean {\n    return this._activeTheme === VantageTheme.LIGHT;\n  }\n\n  public activeTheme(): VantageTheme {\n    return this._activeTheme;\n  }\n\n  public applyLightTheme(): void {\n    this.applyTheme(VantageTheme.LIGHT);\n  }\n\n  public applyDarkTheme(): void {\n    this.applyTheme(VantageTheme.DARK);\n  }\n\n  public toggleTheme(): void {\n    this._activeTheme === VantageTheme.DARK ? this.applyLightTheme() : this.applyDarkTheme();\n  }\n\n  public map(mapObject: IVantageThemeMap, fallback?: any): Observable<any> {\n    return this.activeTheme$.pipe(map((value: VantageTheme) => (value in mapObject ? mapObject[value] : fallback)));\n  }\n\n  private applyTheme(theme: VantageTheme): void {\n    this._renderer2.removeClass(\n      this._document.querySelector('html'),\n      theme === VantageTheme.DARK ? VantageTheme.LIGHT : VantageTheme.DARK,\n    );\n    localStorage.setItem(THEME_LOCAL_STORAGE_KEY, theme);\n    this._renderer2.addClass(this._document.querySelector('html'), theme);\n    this._activeTheme = <VantageTheme>localStorage.getItem(THEME_LOCAL_STORAGE_KEY);\n  }\n}\n\nexport function VANTAGE_THEME_PROVIDER_FACTORY(\n  parent: VantageThemeService,\n  rendererFactory: RendererFactory2,\n  _document: any,\n): VantageThemeService {\n  return parent || new VantageThemeService(rendererFactory, _document);\n}\n\nexport const VANTAGE_THEME_PROVIDER: Provider = {\n  // If there is already a service available, use that. Otherwise, provide a new one.\n  provide: VantageThemeService,\n  deps: [[new Optional(), new SkipSelf(), VantageThemeService], [RendererFactory2], [DOCUMENT]],\n  useFactory: VANTAGE_THEME_PROVIDER_FACTORY,\n};\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { VANTAGE_THEME_PROVIDER } from './theme.service';\n\n@NgModule({\n  imports: [CommonModule],\n  providers: [VANTAGE_THEME_PROVIDER],\n})\nexport class VantageThemeModule {}\n"],"names":[],"mappings":"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"}