!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@td-vantage/ui-platform/sqle",["exports","@angular/core","@angular/common/http","rxjs/operators","@angular/common"],t):t(((e=e||self)["td-vantage"]=e["td-vantage"]||{},e["td-vantage"]["ui-platform"]=e["td-vantage"]["ui-platform"]||{},e["td-vantage"]["ui-platform"].sqle={}),e.ng.core,e.ng.common.http,e.rxjs.operators,e.ng.common)}(this,(function(e,t,n,a,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function o(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var i=function(){function e(e){this._httpClient=e}return e.prototype.querySystem=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds?(r=r.set("X-Auth-Credentials","Basic "+e.creds),t.logMech=e.system.system_attributes.attributes.log_mech||"DEFAULT"):t.logMech="JWT",t.clientId="VANTAGE.EDITOR",this._httpClient.post("/api/query/tdrest/systems/"+e.system.nickname+"/queries",t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.getTableInfo=function(e,t,r){var o=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(o=o.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.get("/api/query/systems/"+e.system.nickname+"/databases/"+t+"/tables/"+r,{headers:o}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.getViewInfo=function(e,t,r){var o=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(o=o.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.get("/api/query/systems/"+e.system.nickname+"/databases/"+t+"/views/"+r,{headers:o}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.getQuery=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(r=r.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.get("/api/query/tdrest/systems/"+e.system.nickname+"/queries/"+t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.getQueries=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(r=r.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.get("/api/query/tdrest/systems/"+e.system.nickname+"/queries?session="+t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.getQueryResult=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(r=r.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.get("/api/query/tdrest/systems/"+e.system.nickname+"/queries/"+t+"/results",{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.deleteQuery=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(r=r.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.delete("/api/query/tdrest/systems/"+e.system.nickname+"/queries/"+t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.createSession=function(e){var t={autoCommit:"true",transactionMode:"TERA",charSet:"UTF8"},r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds?(r=r.set("X-Auth-Credentials","Basic "+e.creds),t.logMech=e.system.system_attributes.attributes.log_mech||"DEFAULT"):t.logMech="JWT",this._httpClient.post("/api/query/tdrest/systems/"+e.system.nickname+"/sessions",t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.prototype.deleteSession=function(e,t){var r=(new n.HttpHeaders).append("Accept","application/vnd.com.teradata.rest-v1.0+json").append("Content-Type","application/json");return e.creds&&(r=r.set("X-Auth-Credentials","Basic "+e.creds)),this._httpClient.delete("/api/query/tdrest/systems/"+e.system.nickname+"/sessions/"+t,{headers:r}).pipe(a.catchError((function(e){throw e.error})),a.map((function(e){return e})))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:n.HttpClient}]},e}();function s(e,t){return e||new i(t)}var u={provide:i,deps:[[new t.Optional,new t.SkipSelf,i],n.HttpClient],useFactory:s},c=["DBC","dbcmngr","SQLJ","SystemFe","SysAdmin","SYSBAR","SYSJDBC","SYSLIB","SYSUDTLIB","TDMaps","TD_SERVER_DB","TD_SYSFNLIB","TD_SYSXML","Sys_Calendar"];var p=function(){function e(e){this._queryService=e}return e.prototype.getViewHelp=function(e,t,n){var r=this,o="\n      LOCK ROW FOR ACCESS\n      SELECT CAST(COUNT(*) AS BIGINT) as cnt\n      FROM "+t+"."+n+";\n      SHOW VIEW "+t+"."+n+";\n    ";return this._queryService.getViewInfo(e,t,n).pipe(a.map((function(e){return e.columns.map((function(t){return{comment:t.remarks,type:"column",columnType:t.type,name:t.name,database:e.database,table:e.name}}))})),a.switchMap((function(i){return r._queryService.querySystem(e,{query:o}).pipe(a.map((function(e){var a,r="";e.results[1].data.forEach((function(e){r+=e["Request Text"]})),e.results[0].data.forEach((function(e){a=e.cnt}));var o=i.map((function(e){return{columnName:e.name,type:e.columnType}}));return{database:t,view:n,columns:o,count:a,ddlStatement:r}})))})))},e.prototype.getTableHelp=function(e,t,n){var r=this,o="\n      LOCK ROW FOR ACCESS\n      SELECT CAST(COUNT(*) AS BIGINT) as cnt\n      FROM "+t+"."+n+";\n      SHOW TABLE "+t+"."+n+";\n    ";return this._queryService.getTableInfo(e,t,n).pipe(a.map((function(e){return e.columns.map((function(t){return{comment:t.remarks,type:"column",columnType:t.type,name:t.name,database:e.database,table:e.name}}))})),a.switchMap((function(i){return r._queryService.querySystem(e,{query:o}).pipe(a.map((function(e){var a,r="";e.results[1].data.forEach((function(e){r+=e["Request Text"]})),e.results[0].data.forEach((function(e){a=e.cnt}));var o=i.map((function(e){return{columnName:e.name,type:e.columnType}}));return{database:t,table:n,columns:o,count:a,ddlStatement:r}})))})))},e.prototype.getDatabaseFunction=function(e,t){var n="\n      HELP 'SQL "+t+"';\n    ";return this._queryService.querySystem(e,{query:n}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return e["On-Line Help"]})).join(" ")})))},e.prototype.getDatabaseFunctions=function(e){return this._queryService.querySystem(e,{query:"\n      HELP 'SQL';\n    "}).pipe(a.map((function(e){var t=e.results[0].data.map((function(e){return e["On-Line Help"]})).join(" "),n=t.indexOf("FUNCTIONS")+12;return(t=t.substr(n,t.length)).split(" ").filter((function(e){return e})).map((function(e){return{name:e}}))})))},e.prototype.getAnalyticalFunctions=function(e){return this._queryService.querySystem(e,{query:'\n      HELP FOREIGN SCHEMA "public"@coprocessor;\n    '}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.objectname}}))})))},e.prototype.getAnalyticalFunction=function(e,t){var n='\n      HELP FOREIGN FUNCTION "public"."'+t+'"@coprocessor;\n    ';return this._queryService.querySystem(e,{query:n}).pipe(a.map((function(e){for(var t="",n="",a="",r="",o="",i="",s=e.results[0].data.map((function(e){return e["Function Help"]})),u=0;u<s.length;u++){var c=s[u];if(c.indexOf("Function Name:")>-1)for(u++;u<s.indexOf("");u++)t+=s[u]+"\n";else if(c.indexOf("Short Description:")>-1)for(u++;u<s.indexOf("");u++)n+=s[u]+"\n";else if(c.indexOf("Long Description:")>-1)for(u++;u<s.indexOf("");u++)a+=s[u]+"\n";else if(c.indexOf("Usage Syntax:")>-1)for(u++;u<s.indexOf("");u++)r+=s[u]+"\n";else if(c.indexOf("Input Columns:")>-1)for(u++;u<s.indexOf("");u++)o+=s[u]+"\n";else if(c.indexOf("Output Columns:")>-1)for(u++;u<s.indexOf("");u++)i+=s[u]+"\n";else s.indexOf("")>-1&&(u=s.indexOf(""),s[u]=void 0)}return{functionName:t,shortDescription:n,longDescription:a,usageSyntax:r,inputColumns:o,outputColumns:i}})))},e.prototype.resultSetPredicate=function(e){return e.results[0].data.map((function(e){return{name:e.TableName,requestText:e.RequestText,comment:e.CommentString,kind:e.TableKind}}))},e.prototype.getStoredProcedures=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'P'\n      ORDER BY TableName ASC;\n    "}).pipe(a.map(this.resultSetPredicate))},e.prototype.getExternalStoredProcedures=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'E'\n      ORDER BY TableName ASC;\n    "}).pipe(a.map(this.resultSetPredicate))},e.prototype.getMacros=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT DataBaseName, TableName, TableKind, RequestText, CommentString FROM dbc.tablesvx\n      WHERE TableKind = 'M'\n      ORDER BY TableName ASC;\n    "}).pipe(a.map(this.resultSetPredicate))},e.prototype.functionsvxPredicate=function(e){return e.results[0].data.map((function(e){return{database:e.DatabaseName,name:e.SpecificName,paramNumber:e.NumParameters,paramDataTypes:e.ParameterDataTypes,requestText:e.RequestText,commentString:e.CommentString,kind:e.TableKind}}))},e.prototype.getTableOperators=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT func.DatabaseName, func.FunctionName, func.SpecificName, func.NumParameters,\n      func.ParameterDataTypes, tbl.RequestText, tbl.CommentString, tbl.TableKind\n      FROM dbc.functionsvx as func\n      INNER JOIN dbc.tablesvx as tbl\n      ON tbl.TableName = func.SpecificName\n      AND tbl.DataBaseName = func.DatabaseName\n      WHERE FunctionType = 'L'\n      ORDER BY func.FunctionName ASC;\n    "}).pipe(a.map(this.functionsvxPredicate))},e.prototype.getTableFunctions=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT func.DatabaseName, func.FunctionName, func.SpecificName, func.NumParameters,\n      func.ParameterDataTypes, tbl.RequestText, tbl.CommentString, tbl.TableKind\n      FROM dbc.functionsvx as func\n      INNER JOIN dbc.tablesvx as tbl\n      ON tbl.TableName = func.SpecificName\n      AND tbl.DataBaseName = func.DatabaseName\n      WHERE FunctionType = 'R'\n      ORDER BY func.FunctionName ASC;\n    "}).pipe(a.map(this.functionsvxPredicate))},e.prototype.getForeignServers=function(e){return this._queryService.querySystem(e,{query:"\n      SELECT TableName, TableKind FROM DBC.TABLESVX\n      WHERE DATABASENAME = 'TD_SERVER_DB' AND\n      TABLEKIND = 'K' AND\n      TableName <> 'coprocesor';\n    "}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.TableName,kind:e.TableKind}}))})))},e.prototype.getForeignSchemas=function(e,t){var n="\n      HELP FOREIGN SERVER "+t+";\n    ";return this._queryService.querySystem(e,{query:n}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.Schema,kind:"NONE"}}))})))},e.prototype.getForeignTables=function(e,t,n){var r='\n      HELP FOREIGN DATABASE "'+n+'"@'+t+";\n    ";return this._queryService.querySystem(e,{query:r}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.Table,kind:"NONE"}}))})))},e.prototype.getForeignColumns=function(e,t,n,r){var o='\n      HELP FOREIGN TABLE "'+n+'"."'+r+'"@'+t+";\n    ";return this._queryService.querySystem(e,{query:o}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.Column,type:e.Type}}))})))},e.prototype.getDatabases=function(e){return this._queryService.querySystem(e,{query:"SELECT databasename, PermSpace, SpoolSpace, TempSpace, CommentString, DBKind FROM dbc.databasesVX ORDER BY databasename;"}).pipe(a.map((function(e){return e.results[0].data.map((function(e){return{name:e.DatabaseName||e.schemaname,type:"U"===e.DBKind?"user":"database",permSpace:e.PermSpace,spoolSpace:e.SpoolSpace,tempSpace:e.TempSpace,comment:e.CommentString}}))})))},e.prototype.getDatabaseObjects=function(e,t){var n="SELECT DataBaseName, TableName, TableKind, CommentString FROM dbc.tablesvx\n       WHERE TableKind in ('T', 'O', 'V') AND DataBaseName = '"+t+"' ORDER BY TableName ASC;";return this._queryService.querySystem(e,{query:n}).pipe(a.map((function(e){return e.results[0].data.map((function(e){var t=e.TableKind||e.tablekind;return{kind:e.TableKind||e.tablekind,type:"V"===t?"view":"table",name:e.TableName||e.tablename,database:e.DataBaseName||e.databasename,comment:e.CommentString}}))})))},e.prototype.getTableColumns=function(e,t,n,r){return"table"===e?this._queryService.getTableInfo(t,n,r).pipe(a.map((function(e){return e.columns.map((function(t){return{comment:t.remarks,type:"column",columnType:t.type,name:t.name,database:e.database,table:e.name}}))}))):"view"===e?this._queryService.getViewInfo(t,n,r).pipe(a.map((function(e){return e.columns.map((function(t){return{comment:t.remarks,type:"column",columnType:t.type,name:t.name,database:e.database,table:e.name}}))}))):void 0},e.prototype.search=function(e,t,n){void 0===n&&(n={databases:!0,objects:!0,columns:!0});var r=[];if(n.databases){var o="\n        SELECT\n            DatabaseName as objectName,\n            'database' as objectType,\n            DBKind as kind,\n            CommentString\n        FROM dbc.databasesvx\n        WHERE DatabaseName LIKE '%"+t+"%'\n        AND DataBaseName NOT IN ('"+c.join("', '")+"')\n      ";r.push(o)}if(n.objects){var i="\n        SELECT\n            DataBaseName || '~|~' || TableName as objectName,\n            'object' as objectType,\n            TableKind as kind,\n            CommentString\n        FROM dbc.tablesvx\n        WHERE TableKind in ('T', 'O', 'V')\n        AND TableName LIKE '%"+t+"%'\n        AND DataBaseName NOT IN ('"+c.join("', '")+"')\n      ";r.push(i)}if(n.objects){var s="\n        SELECT\n            DataBaseName || '~|~' || TableName || '~|~' || ColumnName as objectName,\n            'column' as objectType,\n            ColumnType as kind,\n            CommentString\n        FROM dbc.columnsVX\n        WHERE columnname LIKE '%"+t+"%'\n        AND DataBaseName NOT IN ('"+c.join("', '")+"')\n      ";r.push(s)}var u="\n      WITH quick_search AS (\n          "+r.join("UNION")+"\n      )\n      SELECT * FROM quick_search\n      ORDER BY 1\n      SAMPLE 100;\n    ";return this._queryService.querySystem(e,{query:u}).pipe(a.map((function(e){return e.results[0].data.map((function(e){var t=e.kind;t="column"===e.objectType?"column":"database"===e.objectType?"D"===t?"database":"user":"V"===t?"view":"table";for(var n=[],a=e.objectName.split("~|~"),r=0;r<a.length-1;r++)n.push('"'+a[r]+'"');return{parent:n.join("."),name:a[a.length-1],kind:t,type:e.objectType,comment:e.CommentString}}))})))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:i}]},e}();function m(e,t){return e||new p(t)}var l={provide:p,deps:[[new t.Optional,new t.SkipSelf,p],i],useFactory:m},d=function(){function e(e){this._queryService=e}return Object.defineProperty(e.prototype,"current",{get:function(){return JSON.parse(sessionStorage.getItem("vantage.editor.connection"))},enumerable:!0,configurable:!0}),e.prototype.disconnect=function(){sessionStorage.removeItem("vantage.editor.connection")},e.prototype.connect=function(e){return t=this,n=void 0,i=function(){return o(this,(function(t){switch(t.label){case 0:return this.disconnect(),[4,this._queryService.querySystem(e,{query:"SELECT 1;"}).pipe(a.timeout(7e3),a.retry(1)).toPromise()];case 1:return t.sent(),this.store(e),[2]}}))},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{u(i.next(e))}catch(e){a(e)}}function s(e){try{u(i.throw(e))}catch(e){a(e)}}function u(t){t.done?e(t.value):new r((function(e){e(t.value)})).then(o,s)}u((i=i.apply(t,n||[])).next())}));var t,n,r,i},e.prototype.store=function(e){var t=e.system,n=e.creds;sessionStorage.setItem("vantage.editor.connection",JSON.stringify({system:t,creds:n}))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:i}]},e}();function y(e,t){return e||new d(t)}var f={provide:d,deps:[[new t.Optional,new t.SkipSelf,d],i],useFactory:y},b=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule],providers:[f,l,u]}]}],e}();e.VANTAGE_CONNECTION_PROVIDER=f,e.VANTAGE_CONNECTION_PROVIDER_FACTORY=y,e.VANTAGE_DICTIONARY_PROVIDER=l,e.VANTAGE_DICTIONARY_PROVIDER_FACTORY=m,e.VANTAGE_QUERY_PROVIDER=u,e.VANTAGE_QUERY_PROVIDER_FACTORY=s,e.VantageConnectionService=d,e.VantageDictionaryService=p,e.VantageQueryService=i,e.VantageSQLEModule=b,e.sysDatabases=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=td-vantage-ui-platform-sqle.umd.min.js.map